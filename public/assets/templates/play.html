<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draw Dash</title>
    <!-- CDN link to bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="assets/styles/gamestyle.css" rel="stylesheet">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="media/images/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="media/images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="media/images/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="media/images/favicon_io/site.webmanifest">
</head>

<body>
    <div class="position-absolute top-0 end-0 m-3 back-home d-none">
        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="36" height="36" viewBox="0,0,256,256"
            style="fill:#000000;">
            <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                font-family="none" font-weight="none" font-size="none" text-anchor="none"
                style="mix-blend-mode: normal">
                <g transform="scale(10.66667,10.66667)">
                    <path
                        d="M12,2c-0.26712,0.00003 -0.52312,0.10694 -0.71094,0.29688l-10.08594,8.80078c-0.12774,0.09426 -0.20313,0.24359 -0.20312,0.40234c0,0.27614 0.22386,0.5 0.5,0.5h2.5v8c0,0.552 0.448,1 1,1h4c0.552,0 1,-0.448 1,-1v-6h4v6c0,0.552 0.448,1 1,1h4c0.552,0 1,-0.448 1,-1v-8h2.5c0.27614,0 0.5,-0.22386 0.5,-0.5c0.00001,-0.15876 -0.07538,-0.30808 -0.20312,-0.40234l-10.08008,-8.79492c-0.00194,-0.00196 -0.0039,-0.00391 -0.00586,-0.00586c-0.18782,-0.18994 -0.44382,-0.29684 -0.71094,-0.29687z">
                    </path>
                </g>
            </g>
        </svg>
    </div>
    <div class="position-relative p-0 main-container">
        <!-- Modal -->
        <div class="modal text-center pop-out" tabindex="-1" id="gamerules" data-backdrop="static"
            data-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="rules_title">GAME RULES</h5>
                    </div>
                    <div class="modal-body d-flex" id="rules_body">
                        <p></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn custom-btn" id="start">START</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal text-center pop-out" tabindex="-1" id="random_word_modal" data-backdrop="static"
            data-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modal_title">CHOOSE A WORD</h5>
                    </div>
                    <div class="modal-body" id="modal_body">
                        <div id="word_body" class="d-flex"></div>
                        <p class="text-danger mt-4 d-none">Select A Word</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn custom-btn back-home">EXIT</button>
                        <button type="button" class="btn custom-btn" id="word_start">DRAW</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal text-center pop-out" tabindex="-1" id="scoreboard" data-backdrop="static"
            data-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="scoreboard_title">SCORE BOARD</h5>
                    </div>
                    <div class="modal-body">
                        <div id="scoreboard_body">
                            <img src="media/images/stats.png" alt="stats-img" width="48" height="48" class="m-2">
                            <h4 class="mb-3">Game Stats</h4>
                            <div class="stats mx-4 mb-4 p-3">
                                <h2 id="final_guess_count">0</h2>
                                <p>drawings guessed in</p>
                                <h6>120s</h6>
                            </div>
                            <div class="d-flex mx-4">
                                <h6 class="mr-auto">final score</h6>
                                <p class="ml-auto" id="final_game_score">0</p>
                                <span class="ml-1 d-24"></span>
                            </div>
                            <div class="d-flex mx-4">
                                <h6 class="mr-auto">rewards</h6>
                                <div class="ml-auto d-flex align-items-center">
                                    <p class="m-0">+</p>&nbsp;<p id="rewards" class="m-0">0</p>
                                    <img src="media/images/rewards.png" alt="rewards-img" width="24" height="24"
                                        class="ml-1">
                                </div>
                            </div>
                            <div class="stats mx-4 mt-4 p-3">
                                <img src="" alt="user-image" id="user_image" referrerpolicy="no-referrer" class="m-2"
                                    width="48" height="48">
                                <p>Guess Percentage</p>
                                <h4 id="guess_percentage">0%</h4>
                            </div>
                        </div>
                        <p class="text-danger mt-4 d-none"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn custom-btn" id="start_again">PLAY AGAIN</button>
                        <button type="button" class="btn custom-btn back-home">HOME</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="loader-wrapper d-none">
            <div class="loader"></div>
            <span id="start_guessing"></span>
        </div>
        <div class="d-flex align-items-center mt-5 mx2 game-container">
            <div class="d-none d-flex flex-column" id="start_game">
                <div class="canvas-container">
                    <div class="position-relative">
                        <canvas class="canvas-board" id="canva_board"></canvas>
                        <div class="canvas-head">
                            <div
                                class="undo-redo position-absolute top-0 d-flex align-items-center justify-content-center mt-2">
                                <button id="undo" class="btn btn-default btn-sm btn-icon me-3 p-1">
                                    <svg width="24px" height="24px" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 24 24" fill="#8a8a8a" class="ui-svg-inline">
                                        <path class="main-fill"
                                            d="M17,9.5H7.41l1.3-1.29A1,1,0,0,0,7.29,6.79l-3,3a1,1,0,0,0-.21.33,1,1,0,0,0,0,.76,1,1,0,0,0,.21.33l3,3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42L7.41,11.5H17a1,1,0,0,1,1,1v4a1,1,0,0,0,2,0v-4A3,3,0,0,0,17,9.5Z">
                                        </path>
                                    </svg>
                                </button>
                                <button id="redo" class="btn btn-default btn-sm btn-icon p-1">
                                    <svg width="24px" height="24px" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 24 24" fill="#8a8a8a" class="ui-svg-inline">
                                        <path class="main-fill"
                                            d="M19.92,10.12a1,1,0,0,0-.21-.33l-3-3a1,1,0,1,0-1.42,1.42l1.3,1.29H7a3,3,0,0,0-3,3v4a1,1,0,0,0,2,0v-4a1,1,0,0,1,1-1h9.59l-1.3,1.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0l3-3a1,1,0,0,0,.21-.33A1,1,0,0,0,19.92,10.12Z">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                            <!-- <span class="position-relative" id="display_text">Word</span> -->
                            <input type="hidden" name="word" id="hidden_word">

                            <button id="clear"
                                class="btn btn-default btn-sm btn-icon position-absolute top-0 end-0 mt-2 me-2 p-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#8a8a8a">
                                    <path fill="#8a8a8a"
                                        d="M15 3a1 1 0 0 1 1 1h2a1 1 0 1 1 0 2H6a1 1 0 0 1 0-2h2a1 1 0 0 1 1-1h6Z">
                                    </path>
                                    <path fill="#8a8a8a" fill-rule="evenodd"
                                        d="M6 7h12v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V7Zm3.5 2a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 1 0v-9a.5.5 0 0 0-.5-.5Zm5 0a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 1 0v-9a.5.5 0 0 0-.5-.5Z"
                                        clip-rule="evenodd"></path>
                                </svg>
                            </button>

                            <button id="download"
                                class="btn btn-default btn-sm btn-icon position-absolute bottom-0 end-0 mb-3 me-2 p-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <path fill="none" d="M0 0h24v24H0V0z"></path>
                                    <path fill="#8652ca" class="main-fill"
                                        d="M19 13v5c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1v-5c0-.55-.45-1-1-1s-1 .45-1 1v6c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6c0-.55-.45-1-1-1s-1 .45-1 1zm-6-.33l1.88-1.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-3.59 3.59c-.39.39-1.02.39-1.41 0L7.7 12.2c-.39-.39-.39-1.02 0-1.41.39-.39 1.02-.39 1.41 0L11 12.67V4c0-.55.45-1 1-1s1 .45 1 1v8.67z">
                                    </path>
                                </svg>
                            </button>
                        </div>
                        <!-- <span class="position-absolute" id="start_guessing"></span> -->
                        <div class="word-container text-center mb-2 mt-2">
                            <div id="timer" class="mb-4"></div>
                            <div id="wordContainer">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="players-list-container" id="player_list">
                    <!-- <div id="countdown_timer">Time left: <span id="countdown">15</span> seconds</div> -->
                </div>
                <div class="type-guess-container position-relative d-none" id="typebox">
                    <div class="chat-container">
                        <ul id="chat_list" class="px-2 mb-0">

                        </ul>
                    </div>
                    <form id="guess_submit" class="d-flex">
                        <input type="text" name="type-guess" id="type_guess" class="type-guess"
                            placeholder="Type your guess">
                        <input type="image" src="/media/images/submit.png" alt="Submit" class="image-submit"
                            id="submit_guess_icon">
                    </form>
                </div>
                <div class="brush-container d-none">
                    <div class="d-flex align-items-center flex-wrap p-2">
                        <div class="color-container current-color m-1">
                            <button class="btn btn-default color-btn" data-color="#000000"></button>
                        </div>
                        <!-- <div class="color-container m-1">
                            <button class="btn btn-default color-btn" data-color="#ffffff"></button>
                        </div> -->
                        <div class="color-container m-1">
                            <button class="btn btn-default color-btn" data-color="#8144d3"></button>
                        </div>
                        <div class="color-container m-1">
                            <button class="btn btn-default color-btn" data-color="#87CEEB"></button>
                        </div>
                        <div class="color-container m-1">
                            <button class="btn btn-default color-btn" data-color="#3A5F0B"></button>
                        </div>
                        <div class="color-container m-1">
                            <button class="btn btn-default color-btn" data-color="#EC2D01"></button>
                        </div>
                        <div class="color-container m-1">
                            <button class="btn btn-default color-btn" data-color="#FFDF00"></button>
                        </div>
                        <div class="any-color-container m-1">
                            <div class="color-picker-container color-btn">
                                <input type="color" id="colorPicker">
                            </div>
                        </div>
                        <input type="hidden" name="colorValue" id="colorValue" value="#ffffff">
                    </div>
                    <div class="d-flex align-items-center justify-content-between py-2 px-4 brushsize-container mb-3">
                        <input type="range" id="brushSize" min="1" max="50" value="2">
                        <div>
                            <button id="paint" class="btn btn-default btn-sm btn-icon me-3 p-2">
                                <svg width="18px" height="18px" viewBox="0 0 15.821 15.821">
                                    <g id="Group_968" data-name="Group 968" transform="translate(-32.662 -780.398)">
                                        <path id="Icon_material-edit" data-name="Icon material-edit"
                                            d="M4.5,17.021v3.3H7.8l9.72-9.72-3.3-3.3ZM20.064,8.049a.875.875,0,0,0,0-1.239L18.007,4.753a.875.875,0,0,0-1.239,0L15.16,6.362l2.066,2.066,1.23,1.23,1.608-1.608Z"
                                            transform="translate(28.162 775.901)" fill="#8a8a8a"></path>
                                    </g>
                                </svg>
                            </button>
                            <button id="eraser" class="btn btn-default btn-sm btn-icon p-2">
                                <svg width="18px" height="18px" viewBox="0 0 21.981 21.054">
                                    <g transform="translate(-126.034 -780.395)">
                                        <g>
                                            <path
                                                d="M17.983,3.633l5.566,5.554a2.267,2.267,0,0,1,0,3.193L13.216,22.713a4.506,4.506,0,0,1-6.364,0L2.883,18.744a2.267,2.267,0,0,1,0-3.193L14.8,3.633a2.253,2.253,0,0,1,3.182,0M4.468,17.148l3.98,3.969a2.233,2.233,0,0,0,3.182,0L15.6,17.148l-5.566-5.566Z"
                                                transform="translate(123.809 777.42)" fill="#8a8a8a"></path>
                                        </g>
                                    </g>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="submit_drawing" class="d-none position-absolute top-0 start-0">
                    <button type="button" class="btn custom-btn m-2" id="add_drawing_btn">Add</button>
                </div>
            </div>

            <div class="score-container d-none flex-column align-items-center justify-content-center">
                <div class="m-3">
                    <div class="game-score">Game Score: <span id="score">0</span></div>
                </div>
                <div class="m-3">
                    <div id="guess_count">0</div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
    <script src="assets/scripts/jquery.min.js"></script>
    <script src="assets/scripts/privateDrawing.js"></script>
    <script>
        const textInput = document.getElementById("type_guess");
        const user_image = document.getElementById('user_image');
        const userSession = JSON.parse(localStorage.getItem('drawdash_user'));
        window.onload = function () {
            textInput.focus();
        };
        window.addEventListener('load', function () {
            // Check if there is an active session (you need to implement this logic)
            const activeSession = localStorage.getItem('drawdash_user');

            // If there is no active session, redirect to the main URL
            if (!activeSession) {
                window.location.href = '/'; // Replace '/main-url' with your main URL
            }
        });
        if (userSession.imageurl) {
            user_image.src = userSession.imageurl;
        }
        else {
            user_image.src = 'media/images/avatars/panda.svg';
        }
        $(document).ready(function () {
            const constantModes = ['solo', 'private', 'contribute', 'sketch']
            $('#gamerules').modal({ backdrop: 'static', keyboard: false })
            $('#gamerules').modal('show');
            // Get the hash fragment from the URL
            const hashFragment = window.location.hash;
            const count = { 'count': 3 };
            // Remove the '#' character from the hash fragment
            const mode = hashFragment.substring(1); // Remove the '#' character
            // Check if the current URL matches the pattern "/play/*"
            if (window.location.pathname.startsWith('/play')) {
                // Check if there are additional parameters or paths after "/play"
                if (!constantModes.includes(mode) || window.location.search) {
                    // Redirect to the "/home" URL if there are additional parameters or paths
                    window.location.href = '/home';
                }
            }
            function startCountdownForSoloPlay() {
                $('.loader-wrapper').removeClass('d-none');
                var countdownElement = document.getElementById("start_guessing");
                var count = 3;
                countdownElement.innerHTML = "Start Guessing in " + count;

                var countdownInterval = setInterval(function () {
                    count--;
                    countdownElement.innerHTML = "Start Guessing in " + count;
                    if (count === 0) {
                        countdownElement.innerHTML = "";
                        soloPlay();
                        clearInterval(countdownInterval);
                        // Add code here to start the game after the countdown finishes
                    }
                }, 1000); // Update countdown every 1 second
            }
            if (mode == 'solo') {
                $('#clear').addClass('d-none');
                $('.undo-redo').addClass('d-none');
                $('#typebox').removeClass('d-none');
                $('#rules_body p').text('Guess as many as words you can in 120s. Each round lasts 15 seconds maximum');
            }
            else if (mode == 'private') {
                $('#typebox').removeClass('d-none');
                $('#rules_body p').text('Create Your Private Room');
            }
            else if (mode == 'contribute') {
                $('.undo-redo').addClass('d-none');
                $('#player_list').addClass('d-none');
                $('#submit_drawing').removeClass('d-none');
                $('#rules_body p').text('Draw for a word');
                $('.brush-container').removeClass('d-none');
                $('.brush-container').addClass('d-flex flex-column align-items-center justify-content-center');
            }
            else if (mode == 'sketch') {
                $('.brush-container').removeClass('d-none');
                $('.brush-container').addClass('d-flex flex-column align-items-center justify-content-center');
                $('#rules_body p').text('Sketch & Save your Drawings');
            }
            else {
                window.location.href = '/home';
            }
            let active = false;
            $('#random_word_modal').on('click', '.random-word-btn', function () {
                $('.random-word-btn').removeClass('selected');
                $(this).toggleClass('selected');
                active = true;
            })
            $('#start').click(function () {
                $('#gamerules').modal('hide');
                if (mode == 'solo') {
                    startCountdownForSoloPlay();
                    $('.score-container').removeClass('d-none');
                    $('.score-container').addClass('d-flex');
                }
                else if (mode == 'sketch') {
                    drawing(saveDrawingData = false);
                }
                else if (mode == 'contribute' || mode == 'public') {
                    generateRandomWords();
                    if (mode == 'contribute') {
                        drawing(saveDrawingData = true);
                    }
                    else if (mode == 'private') {
                        joinRoom();
                    }
                }
                $('#start_game').removeClass('d-none');
                $('.back-home').removeClass('d-none');
            })

            $('#word_start').click(function () {
                if ($('.random-word-btn').hasClass('selected')) {
                    $('#random_word_modal').modal('hide');
                    $('#modal_body p').addClass('d-none');
                }
                else {
                    $('#modal_body p').removeClass('d-none');
                }
            })
            $('.color-btn').each(function () {
                // Get the value of the data-color attribute for each element
                var color = $(this).data('color');
                // Set the background color of each element
                $(this).css('background-color', color);
            });
            $("#colorPicker").change(function () {
                $('#colorValue').val($(this).val());
                $('.current-color').removeClass('current-color');
                $(this).parent().parent().addClass('current-color');
            });
            $('.color-btn').click(function () {
                $('.current-color').removeClass('current-color');
                $('#colorValue').val($(this).data('color'));
                $(this).parent().addClass('current-color');
            })
            $('#download').click(()=>{
                saveCanvasAsImage();
            });
            $('#start_again').click(function () {
                window.location.reload();
            });
            $('.back-home').click(function () {
                window.location.href = '/home';
            })
        })
    </script>
</body>

</html>